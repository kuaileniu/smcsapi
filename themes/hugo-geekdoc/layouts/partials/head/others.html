<script src="{{ index .Site.Data.assets "js/darkmode.min.js" | relURL }}"></script>

<link rel="preload" as="font" href="{{ "fonts/Metropolis.woff2" | relURL }}" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="{{ "fonts/LiberationSans.woff2" | relURL }}" type="font/woff2" crossorigin="anonymous">

<link rel="preload" href="{{ index .Site.Data.assets "main.min.css" | relURL }}" as="style">
<link rel="stylesheet" href="{{ index .Site.Data.assets "main.min.css" | relURL }}" media="all">

<link rel="preload" href="{{ index .Site.Data.assets "mobile.min.css" | relURL }}" as="style">
<link rel="stylesheet" href="{{ index .Site.Data.assets "mobile.min.css" | relURL }}" media="screen and (max-width: 45rem)">

<link rel="preload" href="{{ index .Site.Data.assets "print.min.css" | relURL }}" as="style">
<link rel="stylesheet" href="{{ index .Site.Data.assets "print.min.css" | relURL }}" media="print">

<link rel="preload" href="{{ index .Site.Data.assets "custom.css" | relURL }}" as="style">
<link rel="stylesheet" href="{{ index .Site.Data.assets "custom.css" | relURL }}" media="all">

{{ if (default false $.Site.Params.GeekdocOverwriteHTMLBase) }}
<base href="{{ .Site.BaseURL }}">
{{ end }}

{{ printf "<!-- %s -->" "Made with Geekdoc theme https://github.com/thegeeklab/hugo-geekdoc" | safeHTML }}
<!-- zhs添加开始 -->
<script src="https://static.zhsit.cn/smcsdocs/js/jquery/v3.6.0/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
    getParamMap = function() {  
        var url = location.search; //获取url中"?"符后的字串  
        var theRequest = new Object();  
        if (url.indexOf("?") != -1) {  
            var str = url.substr(1);  
            strs = str.split("&");  
            for(var i = 0; i < strs.length; i ++) {  
                theRequest[strs[i].split("=")[0]]=unescape(strs[i].split("=")[1]);  
            }  
        }  
        return theRequest;  
    }; 

    getYYMMDDHHMMSS = function(){
      var now = new Date();
      var year = now.getFullYear(); //得到年份
      var month = now.getMonth();//得到月份
      var date = now.getDate();//得到日期
      var day = now.getDay();//得到周几
      var hour = now.getHours();//得到小时
      var minu = now.getMinutes();//得到分钟
      var sec = now.getSeconds();//得到秒
      month = month + 1;
      if (month < 10) month = "0" + month;
      if (date < 10) date = "0" + date;
      if (hour < 10) hour = "0" + hour;
      if (minu < 10) minu = "0" + minu;
      if (sec < 10) sec = "0" + sec;
      return year+''+month+''+date+''+hour+''+minu+''+sec
    };

    var current = getYYMMDDHHMMSS()
    var access_token="access_token"
    var url = document.location.toString();
    var uri = window.location.pathname;
    // return true if 有效
    accessTokenOk = function(){
        // 先不非对称加密json, 	//expire 年月日时分秒 "20060102150405"
        var tokenStr = localStorage.getItem(access_token)
        if (tokenStr == null){
            return false;
        }
        var tokenObj = JSON.parse(tokenStr);// string 转对象
        if (tokenObj == null){
            return false
        }
        if ("no" == tokenObj.secret){
            return current < tokenObj.expire
        }
        return false
    }
    
    login = function(callback){
        $.ajax({
            contentType: 'application/json; charset=utf-8',
            type: 'POST',
            url: 'https://smcsdocsserver.zhsit.cn/api/login',
            dataType: "json",
            data:JSON.stringify({
                "username": getParamMap()["username"],
                "password": getParamMap()["password"]
            }),
            success:function(data){
                var tokenStr = JSON.stringify(data) // json对象转string
                localStorage.setItem(access_token,tokenStr)
                callback(true)
            },
            error : function() {
                console.log('smx失败');
                callback(false)
            }
        });
        return true;
    };

    window.onload = function(){
        //加载完成时修改<a> 加上随机数
        $("a").each((index,item) => {
           var thisHref = $(item).attr("href")
           if (thisHref!=null && thisHref.length>0 && thisHref.indexOf("#")!=0){
                thisHref += "?r=" + new Date().getTime();
                $(item).attr("href",thisHref)
           }
        });
        if (url.indexOf("username") > 0 || url.indexOf("password") > 0 ) {
            login(function(success){
                if(success){
                    removePwd()
                }else{
                    window.location.href = window.location.protocol+"//"+window.location.host+"?r="+new Date().getTime()
                }
            })
            return false;
        }
        if(!accessTokenOk()){
            if ("/" == uri) {
                $("a").each((index,item) => { // 防止跳出去再跳回来
                    $(item).attr("href","#")
                });
                return false
            }
            window.location.href = window.location.protocol+"//"+window.location.host+"?r="+new Date().getTime()
        } 
    }
    removePwd = function(){
        window.location.href = window.location.protocol+"//"+window.location.host+""+window.location.pathname+"?r="+new Date().getTime() 
    }
</script>
<!-- zhs添加结束 -->